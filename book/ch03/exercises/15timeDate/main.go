package main

import (
	"fmt"
	"regexp" // пакет для работы с регулярными выражениями
	"time"   // пакет для работы со временем
)

func main() {

	// Срез строк — имитация лог-файла (например, Apache/Nginx)
	// Формат даты в логах: [день/месяц/год:час:минута:секунда смещение]
	logs := []string{
		"127.0.0.1 - - [16/Nov/2017:10:49:46 +0200] 325504",
		"127.0.0.1 - - [16/Nov/2017:10:16:41 +0200] \"GET /CVEN HTTP/1.1\" 200 12531 \"-\" \"Mozilla/5.0 AppleWebKit/537.36\"",
		"127.0.0.1 200 9412 - - [12/Nov/2017:06:26:05 +0200] \"GET\" \"http://www.mtsoukalos.eu/taxonomy/term/47\" 1507",
		"[12/Nov/2017:16:27:21 +0300]",
		"[12/Nov/2017:20:88:21 +0200]", // невалидное время (минуты 88)
		"[12/Nov/2017:20:21 +0200]",    // неполное время (нет секунд) — regex может не найти
	}

	for _, logEntry := range logs {

		// Регулярное выражение для извлечения даты-времени из строки лога
		// Разбор: .* — любые символы до скобки
		//         \[ — открывающая скобка [ (экранирована)
		//         (\d\d\/\w+/\d\d\d\d:\d\d:\d\d:\d\d.*) — группа захвата:
		//           \d\d — день (две цифры)
		//           \/ — слэш
		//           \w+ — месяц (буквы, например Nov)
		//           /\d\d\d\d — год (четыре цифры)
		//           :\d\d:\d\d:\d\d — часы:минуты:секунды (обязательно две цифры на каждое)
		//           .* — остаток (смещение часового пояса, например +0200)
		//         \] — закрывающая скобка ]
		//         .* — любые символы после
		r := regexp.MustCompile(`.*\[(\d\d\/\w+/\d\d\d\d:\d\d:\d\d:\d\d.*)\].*`)

		// Проверяем, подходит ли строка под регулярное выражение
		if r.MatchString(logEntry) {

			// FindStringSubmatch возвращает срез: [полное совпадение, группа 1, группа 2, ...]
			// match[0] — вся строка, match[1] — первая группа (дата-время в скобках)
			match := r.FindStringSubmatch(logEntry)

			// Парсим извлечённую строку даты-времени в тип time.Time
			// Формат "02/Jan/2006:15:04:05 -0700" соответствует виду "16/Nov/2017:10:49:46 +0200"
			// (в Go эталонная дата для формата: 02 = день, Jan = месяц, 2006 = год, 15:04:05 = время, -0700 = смещение)
			dt, err := time.Parse("02/Jan/2006:15:04:05 -0700", match[1])

			if err == nil {

				// Преобразуем время в формат RFC850 (например: Monday, 16-Nov-17 10:49:46 +0200)
				newFormat := dt.Format(time.RFC850)

				fmt.Println(newFormat)

			} else {

				// Парсинг не удался (например, невалидные минуты 88 в одной из строк)
				fmt.Println("Not a valid date time format!")

			}

		} else {

			// Строка не подошла под регулярное выражение (например, нет полного времени с секундами)
			fmt.Println("Not a match!")
		}

	}
}
